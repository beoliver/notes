# Part 2

## Loading Code

Now that we know how to start a REPL we can play around with the language.

```sh
.
├── jars
│   ├── clojure-1.11.3.jar
│   ├── core.specs.alpha-0.2.62.jar
│   └── spec.alpha-0.3.218.jar
└── src
    └── example
        ├── core.clj
        └── thing.clj

```
Where the file "/src/example/thing.clj" has the following content:

```clojure
(ns example.thing)

(println "This is a side effect in 'example.thing'")

(defn greet [name]
  (println (format "Hello, %s." name)))
```

And the file "/src/example/core.clj" has the following content:

```clojure
(ns example.core
  (:require [example.thing :as thing])
  (:gen-class))

(println "This is a side effect in 'example.core'")

(defn -main [& args]
  (thing/greet "You"))
```

Note the `(:gen-class)` in the namespace definition. 
Note the `-main` function. The `-` prefix.


```clojure
user=> (compile 'example.core)
Unexpected error (IOException) macroexpanding clojure.core/gen-class at (example/core.clj:1:1).
No such file or directory
user=> *compile-path*
"classes"
```

```bash 
$ mkdir classes
$ java -cp "jars/*:src:classes" clojure.main
```

```clojure
Clojure 1.11.1
user=> (compile 'example.core)
This is another side effect
example.core
^D
```

```bash
$ tree classes
classes
├── clojure
│   └── core
│       └── specs
│           ├── alpha$even_number_of_forms_QMARK_.class
│           ├── ...
│           └── alpha__init.class
└── example
    ├── core$_main.class
    ├── core$fn__133.class
    ├── core$loading__6789__auto____126.class
    ├── core.class
    ├── core__init.class
    ├── thing$fn__130.class
    ├── thing$greet.class
    ├── thing$loading__6789__auto____128.class
    └── thing__init.class
```

## Create an Uberjar

By creating an uberjar, it is possible to ship a single jar file.


```bash
echo "Manifest-Version: 1.0\nMain-Class: example.core" > manifest.txt
mkdir -p temp
cd temp
for jar in ../jars/*.jar; do
    jar xf "$jar"
done
cd ..
jar cfm example-uberjar.jar manifest.txt -C classes/ . -C temp/ .
```





### `load-file`. 

We start clojure and include the jars on the class path, but do **not** include the `src` directory.

```sh 
java -cp "jars/*" clojure.main
```

We can use `load-file` to load any file we want. if the path does not start with a `/` then it is considered relative to the directory that the clojure runtime was started.

```clojure
user=> (load-file "src/example/core.clj")
This is a side effect
#'example.core/greet
user=> (example.core/greet "You")
Hello, You.
nil
```

### `load`. 

```sh
java -cp "jars/*" clojure.main
```

```clojure
user=> (load "/example/core")
Execution error (FileNotFoundException) at user/eval1 (REPL:1).
Could not locate example/core__init.class, example/core.clj or example/core.cljc on classpath.
```

In order to use `load` we need to first add the `src` directory to our class path. Note that `/example/core` mimics the namespace `example.core`.

```sh
java -cp "jars/*:src" clojure.main
```

```clojure
user=> (load "/example/core")
This is a side effect
nil
user=> (example.core/greet "You")
Hello, You.
nil
```

Similar to `load-file` but it returns `nil`.

### `require`

```sh
java -cp "jars/*" clojure.main
```

```clojure 
user=> (require '[example.core :as core])
Execution error (FileNotFoundException) at user/eval1 (REPL:1).
Could not locate example/core__init.class, example/core.clj or example/core.cljc on classpath.
```

```sh
java -cp "jars/*:src" clojure.main
```

```clojure 
user=> (require '[example.core :as core])
This is a side effect
nil 
user=> (core/greet "Ben")
Hello, Ben.
```


### Reloading a file. 

What happens if we make a change to the file? Make sure that you are in the REPL and have already required the namespace

```sh
java -cp "jars/*:src" clojure.main
```

```clojure 
user=> (require '[example.core :as core])
This is a side effect
nil 
user=> (core/greet "Ben")
Hello, Ben.
```

Now, let's change the content of 'src/example/core.clj' to contain the following:

```clojure
(ns example.core)

(println "This is ANOTHER side effect")

(defn greet [name]
  (println (format "BYE BYE, %s." name)))
```

The capitalized words are changes.

```clojure
user=> (require '[example.core :as core])
nil 
user=> (core/greet "Ben")
Hello, Ben.
```
That's interesting. The `require` function seems to cache the result. This means that our changed file is not picked up.



```clojure
user=> (load-file "src/example/core.clj")
#'example.core/greet
user=> (require '[example.core :as core])
nil
user=> (core/greet "Ben")
Hello, Ben.
nil
```

Let's update the greet function to say "Goodbye".

```clojure
(ns example.core)

(defn greet [name]
  (println (format "Goodbye, %s." name)))
```

```clojure
user=> (load-file "src/example/core.clj")
#'example.core/greet
user=> (core/greet "Ben")
Goodbye, Ben.
nil
```

Notice that we did not need to call `require` again. 


